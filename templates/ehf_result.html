<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R√©sultats d'analyse EHF - Office Notarial Briatte</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --notarial-gold: #B8860B;
            --notarial-dark: #2c3e50;
            --notarial-light: #f8f9fa;
            --notarial-blue: #1e3a8a;
        }
        
        body {
            font-family: 'Georgia', 'Times New Roman', serif;
            background-color: var(--notarial-light);
            color: var(--notarial-dark);
            line-height: 1.6;
        }
        
        .header-notarial {
            background: linear-gradient(135deg, var(--notarial-gold), #DAA520);
            color: white;
            padding: 1.5rem 0;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .logo-briatte {
            width: 80px;
            height: 80px;
            background: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .logo-briatte .logo-b {
            font-size: 2.5rem;
            font-weight: 300;
            color: var(--notarial-gold);
            font-family: 'Times New Roman', serif;
        }
        
        .office-info h1 {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 0.2rem;
            letter-spacing: 0.5px;
        }
        
        .office-info .subtitle {
            font-size: 1rem;
            opacity: 0.9;
            font-weight: 300;
        }
        
        .office-info .location {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 0.2rem;
        }
        
        .card-notarial {
            border: none;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            background: white;
            margin-bottom: 1.5rem;
        }
        
        .card-header-notarial {
            background: linear-gradient(135deg, var(--notarial-gold), #DAA520);
            color: white;
            border-radius: 12px 12px 0 0 !important;
            padding: 1rem 1.5rem;
            border: none;
        }
        
        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin: 0;
            display: flex;
            align-items: center;
        }
        
        .section-icon {
            margin-right: 0.75rem;
            font-size: 1.4rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border-left: 4px solid var(--notarial-gold);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--notarial-gold);
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: var(--notarial-dark);
            font-size: 0.95rem;
            font-weight: 500;
        }
        
        .proprietaire-card {
            background: linear-gradient(135deg, #f8f9ff, #ffffff);
            border: 2px solid #e3f2fd;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            position: relative;
        }
        
        .proprietaire-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(to bottom, var(--notarial-gold), #DAA520);
            border-radius: 4px 0 0 4px;
        }
        
        .proprietaire-name {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--notarial-dark);
            margin-bottom: 0.5rem;
        }
        
        .proprietaire-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .detail-item {
            display: flex;
            align-items: center;
            padding: 0.5rem;
            background: rgba(184, 134, 11, 0.05);
            border-radius: 8px;
        }
        
        .detail-label {
            color: var(--notarial-gold);
            font-weight: 600;
            margin-right: 0.75rem;
            min-width: 140px;
            display: inline-block;
            font-size: 0.9rem;
        }
        
        .hypotheque-card {
            background: linear-gradient(135deg, #fff8f0, #ffffff);
            border: 2px solid #ffeaa7;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            position: relative;
        }
        
        .hypotheque-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(to bottom, #e17055, #fdcb6e);
            border-radius: 4px 0 0 4px;
        }
        
        .hypotheque-montant {
            font-size: 1.6rem;
            font-weight: bold;
            color: #e17055;
            margin-bottom: 0.5rem;
        }
        
        .btn-notarial {
            background: linear-gradient(135deg, var(--notarial-gold), #DAA520);
            border: none;
            color: white;
            font-weight: 600;
            padding: 0.75rem 2rem;
            border-radius: 8px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
        }
        
        .btn-notarial:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(184, 134, 11, 0.3);
            color: white;
        }
        
        .badge-notarial {
            background: var(--notarial-gold);
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .no-data {
            text-align: center;
            padding: 3rem;
            color: #6c757d;
        }
        
        .no-data i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        .timeline-item {
            border-left: 3px solid var(--notarial-gold);
            padding-left: 1.5rem;
            margin-bottom: 1.5rem;
            position: relative;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -8px;
            top: 0.5rem;
            width: 12px;
            height: 12px;
            background: var(--notarial-gold);
            border-radius: 50%;
        }
        
        .timeline-date {
            font-weight: 600;
            color: var(--notarial-gold);
            font-size: 0.9rem;
        }
        
        .timeline-content {
            margin-top: 0.5rem;
        }
        
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .proprietaire-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- En-t√™te Office Notarial Briatte -->
    <div class="header-notarial">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-auto">
                    <div class="logo-briatte">
                        <div class="logo-b">B</div>
                    </div>
                </div>
                <div class="col office-info">
                    <h1>OFFICE NOTARIAL DE SAINT-JEAN-CAP-FERRAT</h1>
                    <div class="subtitle">Alain-Xavier BRIATTE, Notaire Associ√©</div>
                    <div class="location">SAINT-JEAN-CAP-FERRAT - FRANCE</div>
                </div>
                <div class="col-auto">
                    <a href="/" class="btn btn-notarial">
                        <i class="fas fa-upload me-2"></i>
                        Nouveau document
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Informations du document -->
        <div class="row mb-4">
            <div class="col">
                <div class="card card-notarial">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h3 class="mb-1">
                                    <i class="fas fa-file-pdf text-danger me-2"></i>
                                    {{ result.filename }}
                                </h3>
                                <p class="text-muted mb-0">
                                    <i class="fas fa-clock me-1"></i>
                                    Analys√© le {{ result.date_analyse }}
                                </p>
                            </div>
                            <div class="text-end">
                                <span class="badge badge-notarial">
                                    <i class="fas fa-check-circle me-1"></i>
                                    Analyse termin√©e
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistiques -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">{{ result.statistiques.nb_formalites }}</div>
                <div class="stat-label">Formalit√©s</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ result.statistiques.nb_hypotheques_actives }}</div>
                <div class="stat-label">Hypoth√®ques/privil√©ges actives</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ result.statistiques.nb_mutations }}</div>
                <div class="stat-label">Mutations</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ result.statistiques.nb_immeubles }}</div>
                <div class="stat-label">Immeubles</div>
            </div>
        </div>

        <div class="row">
            <!-- Propri√©taires actuels -->
            <div class="col-lg-6 mb-4">
                <div class="card card-notarial">
                    <div class="card-header-notarial">
                        <h4 class="section-title">
                            <i class="fas fa-home section-icon"></i>
                            Propri√©taires actuels
                        </h4>
                    </div>
                    <div class="card-body">
                        {% if result.propriete_actuelle %}
                            {% for propriete in result.propriete_actuelle %}
                            <div class="proprietaire-card">
                                <div class="proprietaire-name">
                                    {% if propriete.proprietaire.designation != "PROPRIETAIRE INCONNU" %}
                                        {{ propriete.proprietaire.designation }}
                                    {% else %}
                                        <span class="text-muted">Propri√©taire non identifi√©</span>
                                    {% endif %}
                                </div>
                                
                                <div class="proprietaire-details">
                                    {% if propriete.proprietaire.date_naissance %}
                                    <div class="detail-item">
                                        <span class="detail-label">Date de naissance:</span>
                                        <span>{{ propriete.proprietaire.date_naissance }}</span>
                                    </div>
                                    {% endif %}
                                    
                                    <div class="detail-item">
                                        <span class="detail-label">Commune:</span>
                                        <span>{{ propriete.immeuble.commune }}</span>
                                    </div>
                                    
                                    <div class="detail-item">
                                        <span class="detail-label">D√©signation cadastrale:</span>
                                        <span>{{ propriete.immeuble.designation_cadastrale }}</span>
                                    </div>
                                    
                                    <div class="detail-item">
                                        <span class="detail-label">Lots concern√©s:</span>
                                        <span>{{ propriete.lots|join(', ') }}</span>
                                    </div>
                                    
                                    <div class="detail-item">
                                        <span class="detail-label">Type de droits:</span>
                                        <span>{{ propriete.droits }}</span>
                                    </div>
                                    
                                    {% if propriete.date_acquisition %}
                                    <div class="detail-item">
                                        <span class="detail-label">Date d'acquisition:</span>
                                        <span>{{ propriete.date_acquisition }}</span>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="no-data">
                                <div class="no-data-icon">üè†</div>
                                <p>Aucun propri√©taire identifi√©</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Hypoth√®ques actives -->
            <div class="col-lg-6 mb-4">
                <div class="card card-notarial">
                    <div class="card-header-notarial">
                        <h4 class="section-title">
                            <i class="fas fa-university section-icon"></i>
                            Hypoth√®ques actives
                        </h4>
                    </div>
                    <div class="card-body">
                        {% if result.hypotheques_actives %}
                            {% for hypotheque in result.hypotheques_actives %}
                            <div class="hypotheque-card">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <div>
                                        <div class="hypotheque-montant">
                                            {% if hypotheque.lots_volumes.montant_principal %}
                                                {{ hypotheque.lots_volumes.montant_principal }}
                                            {% else %}
                                                Montant non sp√©cifi√©
                                            {% endif %}
                                        </div>
                                        {% if hypotheque.lots_volumes.accessoires %}
                                        <div class="hypotheque-accessoires" style="font-size: 1rem; color: #e17055; margin-top: 0.25rem;">
                                            + {{ hypotheque.lots_volumes.accessoires }} (accessoires)
                                        </div>
                                        {% endif %}
                                    </div>
                                    <span class="badge bg-warning text-dark" style="white-space: normal; word-wrap: break-word;">
                                        {{ hypotheque.nature_acte }}
                                    </span>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="detail-item mb-2">
                                            <span class="detail-label">Date de d√©p√¥t:</span>
                                            <span>{{ hypotheque.date_depot }}</span>
                                        </div>
                                        {% if hypotheque.date_acte and hypotheque.date_acte != "Non trouv√©" %}
                                        <div class="detail-item mb-2">
                                            <span class="detail-label">Date de l'acte:</span>
                                            <span>{{ hypotheque.date_acte }}</span>
                                        </div>
                                        {% endif %}
                                        {% if hypotheque.reference_enliassement %}
                                        <div class="detail-item mb-2">
                                            <span class="detail-label">R√©f√©rence d'enliassement:</span>
                                            <span>{{ hypotheque.reference_enliassement }}</span>
                                        </div>
                                        {% endif %}
                                        {% if hypotheque.lots_volumes.taux_interet %}
                                        <div class="detail-item mb-2">
                                            <span class="detail-label">Taux d'int√©r√™t:</span>
                                            <span>{{ hypotheque.lots_volumes.taux_interet }}</span>
                                        </div>
                                        {% endif %}
                                    </div>
                                    <div class="col-md-6">
                                        {% if hypotheque.lots_volumes.commune %}
                                        <div class="detail-item mb-2">
                                            <span class="detail-label">Commune:</span>
                                            <span>{{ hypotheque.lots_volumes.commune }}</span>
                                        </div>
                                        {% endif %}
                                        {% if hypotheque.lots_volumes.lots %}
                                        <div class="detail-item mb-2">
                                            <span class="detail-label">Lots concern√©s:</span>
                                            <span>{{ hypotheque.lots_volumes.lots|join(', ') }}</span>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                {% if hypotheque.lots_volumes.date_extreme_exigibilite or hypotheque.lots_volumes.date_extreme_effet %}
                                <div class="mt-2 pt-2 border-top">
                                    {% if hypotheque.lots_volumes.date_extreme_exigibilite %}
                                    <div class="detail-item mb-2">
                                        <span class="detail-label">Date d'extr√™me exigibilit√©:</span>
                                        <span>{{ hypotheque.lots_volumes.date_extreme_exigibilite }}</span>
                                    </div>
                                    {% endif %}
                                    {% if hypotheque.lots_volumes.date_extreme_effet %}
                                    <div class="detail-item mb-2">
                                        <span class="detail-label">Date d'extr√™me effet:</span>
                                        <span>{{ hypotheque.lots_volumes.date_extreme_effet }}</span>
                                    </div>
                                    {% endif %}
                                </div>
                                {% endif %}
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="no-data">
                                <i class="fas fa-university"></i>
                                <p>Aucune hypoth√®que active</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Mutations r√©centes -->
        {% if result.mutations %}
        <div class="row">
            <div class="col-12">
                <div class="card card-notarial">
                    <div class="card-header-notarial">
                        <h4 class="section-title">
                            <i class="fas fa-exchange-alt section-icon"></i>
                            Mutations immobili√®res
                        </h4>
                    </div>
                    <div class="card-body">
                        {% for mutation in result.mutations %}
                        <div class="timeline-item">
                            <div class="timeline-date">{{ mutation.date_depot }}</div>
                            <div class="timeline-content">
                                <h6 class="mb-1" style="white-space: normal; word-wrap: break-word;">{{ mutation.nature_acte }}</h6>
                                <div class="detail-item mb-2">
                                    <span class="detail-label">Date de d√©p√¥t:</span>
                                    <span>{{ mutation.date_depot }}</span>
                                </div>
                                {% if mutation.date_acte and mutation.date_acte != "Non trouv√©" %}
                                <div class="detail-item mb-2">
                                    <span class="detail-label">Date de l'acte:</span>
                                    <span>{{ mutation.date_acte }}</span>
                                </div>
                                {% endif %}
                                {% if mutation.reference_enliassement %}
                                <p class="mb-1">
                                    <strong>R√©f√©rence d'enliassement:</strong> {{ mutation.reference_enliassement }}
                                </p>
                                {% endif %}
                                {% if mutation.mutations.disposant_donateur and mutation.mutations.disposant_donateur|length > 0 %}
                                <p class="mb-1">
                                    <strong>Disposant(s):</strong> 
                                    {% for disposant in mutation.mutations.disposant_donateur %}
                                        {{ disposant.designation }}
                                        {% if disposant.date_naissance %} ({{ disposant.date_naissance }}){% endif %}
                                        {% if not loop.last %}, {% endif %}
                                    {% endfor %}
                                </p>
                                {% endif %}
                                {% if mutation.mutations.beneficiaire_donataire and mutation.mutations.beneficiaire_donataire|length > 0 %}
                                <p class="mb-1">
                                    <strong>B√©n√©ficiaire(s):</strong> 
                                    {% for beneficiaire in mutation.mutations.beneficiaire_donataire %}
                                        {{ beneficiaire.designation }}
                                        {% if beneficiaire.date_naissance %} ({{ beneficiaire.date_naissance }}){% endif %}
                                        {% if not loop.last %}, {% endif %}
                                    {% endfor %}
                                </p>
                                {% endif %}
                                {% if mutation.mutations.immeubles.lots %}
                                <p class="mb-1">
                                    <strong>Lots concern√©s:</strong> {{ mutation.mutations.immeubles.lots|join(', ') }}
                                    {% if mutation.mutations.immeubles.droits %}
                                        ({{ mutation.mutations.immeubles.droits }})
                                    {% endif %}
                                </p>
                                {% endif %}
                                {% if mutation.mutations.montant %}
                                <p class="mb-0">
                                    <strong>Montant:</strong> {{ mutation.mutations.montant }}
                                </p>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
